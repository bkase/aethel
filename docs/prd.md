### **Product Requirements Document (PRD): Aethel v1.5**

**Version:** 1.5
**Status:** Approved
**Author:** Technical Product Manager
**Stakeholders:** The Maker (You)

#### 1. Vision & Introduction

To create a unified, structured, and extensible data foundation for a "personal operating system." This system, **Aethel**, is composed of two primary components:

1. **The `aethel` Tool:** An open-source, high-performance Rust application that provides a standard, powerful interface for creating and managing Aethel vaults.
2. **The Aethel Vault:** A private, user-owned directory of plain text files managed with Git, containing personal artifacts, notes, and the user-defined "plugins" that structure it.

Aethel is designed to be **LLM-first** and **human-readable**, enabling both programmatic interaction and direct manipulation. The ultimate vision is to empower users to build their own systems for intentional living on a stable, transparent, and extensible foundation.

#### 2. Problem Statement

The Maker and other potential users need a way to structure the data generated by a growing suite of personal applications. This data is currently disparate, lacking a unified structure which prevents cross-application insights and efficient retrieval. There is a need for a system that can:

1. Store application outputs and configurations in a consistent, machine-readable format.
2. Be easily created, modified, and validated by a high-performance, safe, and robust CLI.
3. Be fully extensible _by the user_ via a simple plugin system, without requiring modification of the core tool.
4. Remain human-readable and browsable using standard tools like Obsidian or any text editor.
5. Scale to accommodate future data types and applications without requiring an architectural overhaul.

#### 3. Guiding Principles

1. **Tool-Data Decoupling:** The open-source `aethel` tool is completely separate from the user's private vault data. The tool is stateless; the vault is the state.
2. **Open & Extensible:** The core tool is open-source. The vault is extensible via a simple, directory-based plugin system. Anyone can define new data types and structures.
3. **Immutable Identity:** Every artifact is identified by a permanent, unique identifier (UUID), decoupling its identity from mutable properties like filename, location, or content.
4. **Git-Native Core:** Versioning, synchronization, and data integrity are handled by Git, a robust and universally understood tool. All core data is stored as plain text.
5. **LLM-First, Human-in-the-Loop:** The primary interface is programmatic, but the underlying data is transparent and simple, ensuring longevity and direct user access.
6. **Decouple Data & Binaries:** Large binary files (e.g., audio) are stored separately from the core Git repository, which contains only references to them. This keeps the vault lightweight and fast.

#### 4. User Stories (MVP)

- **As a new user,** I want to run `aethel init /path/to/my/vault` to create a new, fully structured Aethel vault, complete with an example plugin, so I can immediately understand how to get started.
- **As a developer, I want to define a new, custom plugin for my application, which allows me to:**
  - Define a unique, namespaced directory (e.g., `journal`) that will be used across the vault for all artifacts and sources related to my plugin.
  - Define custom artifact types and schemas with support for composition/inheritance (e.g., a `morning_journal` type that extends a `base_event` schema).
  - Include rich documentation for both the schemas and the plugin itself within the plugin's Markdown files.
  - Provide system-level templates for my artifact types in an optional `templates/` directory within my plugin.
- **As a user,** I want to run `aethel new --type morning_journal ...` and have the CLI automatically create the new artifact in the correct plugin-specific directory (e.g., `20_artifacts/journal/`).
- **As a user,** I want to append a quick log to an existing artifact using `aethel grow --uuid <uuid> --content "..."`, without having to manually open the file.
- **As a user,** I want `aethel doctor --fix` to be a powerful maintenance command that not only validates my vault against my plugin schemas but also automatically corrects common issues like updating the `updatedAt` timestamp in the frontmatter.
- **As a user,** I want to open my Aethel vault in Obsidian and see a clean, organized folder structure where I can use standard `[[wikilinks]]` for manual note-taking.

#### 5. System Specification

##### 5.1. System Components

1. **`aethel`:** The open-source Rust application. It is configured via a global config file.
2. **Configuration File:** A file at `~/.config/aethel/config.json` that contains the path to the user's Aethel vault.
3. **Aethel Vault:** The user's private directory, managed by Git.

##### 5.2. Aethel Vault Architecture

The vault's structure is organized around **plugins**, which provide namespacing for all associated data.

**Directory Structure:**

```
aethel_vault/
├── 00_inbox/
├── 10_sources/
│   └── journal/      # Sources for the 'journal' plugin
├── 20_artifacts/
│   ├── journal/      # Artifacts from the 'journal' plugin
│   │   └── 2025-07-22-08-00-00.md
│   └── core_note/    # Artifacts from the 'core_note' plugin
├── 30_knowledge/
└── 99_system/
    └── plugins/
        ├── journal/      # The 'journal' plugin directory
        └── core_note/    # The 'core_note' example plugin
```

**Plugin System (`99_system/plugins/`):**
A plugin is a self-contained directory that defines a data domain.

```
plugins/
└── journal/
    ├── plugin.aethel.md  # Core metadata and documentation for the plugin
    ├── schemas/          # Directory containing all schema definitions
    │   ├── base_event.aethel.md
    │   └── morning_journal.aethel.md
    └── templates/        # Optional templates for this plugin's types
        └── morning_journal.md
```

##### 5.3. Core Data Model (Frontmatter)

All artifacts are Markdown files that begin with a YAML frontmatter block.

**Base Schema (Hardcoded in `aethel`):**
This is the universal foundation for all artifacts. All other schemas implicitly extend this one. It is intentionally minimal to ensure maximum flexibility.

```yaml
---
uuid: a1b2c3d4-e5f6-7890-1234-56789abcdef0
type: morning_journal
createdAt: 2025-07-22T08:00:00Z
updatedAt: 2025-07-22T08:05:00Z
tags: [reflection, planning, gratitude]
schemaVersion: 1.0
---
```

**Extended Schemas (Defined in Plugins):**
Plugins define any additional fields required for an artifact type (e.g., `sourceApp`, `durationMinutes`). The `aethel` tool parses these definitions at runtime to perform validation.

##### 5.4. Linking Strategy

- **Canonical Identifier (UUID):** Used by all programmatic logic. This ensures robustness.
- **Human-Readable Links (`[[wikilinks]]`):** Used in the body of notes for user convenience and native Obsidian integration.
- **Bridging the Gap:** The `aethel doctor --fix` command will help maintain link integrity by detecting broken links caused by manual file operations.

##### 5.5. `aethel` Commands (MVP)

- `aethel init <path>`: Initializes a new Aethel vault at the specified path.
- `aethel new --type <type> --title <title>`: Creates a new artifact of a specific type.
- `aethel grow --uuid <uuid> --content <string>`: Appends content to an existing artifact.
- `aethel get --uuid <uuid> [--format json]`: Retrieves a single artifact's full content and frontmatter.
- `aethel doctor [--fix]`: Validates the entire vault and can optionally fix common issues.

##### 5.6. Synchronization & Conflict Mitigation

The idempotency specification remains critical. All applications modifying the vault **must** adhere to the `pull -> read -> modify-in-memory -> write -> commit -> push` cycle to prevent data loss.

#### 6. Future Considerations (Post-MVP)

- **Advanced Querying (`find`):** Implement a powerful `aethel find` command to query artifacts based on frontmatter fields, tags, and date ranges.
- **Data Lifecycle Management:** Introduce an `aethel archive` command.
- **Transclusion:** Implement an `!embed(<uuid>)` syntax and a command to process it.
- **Vector Embeddings:** Add an `aethel index` command to generate and store embeddings for semantic search.

#### 7. Risks & Mitigation

- **Risk: Plugin Complexity.** Users might find creating plugins difficult.
  - **Mitigation:** The `aethel init` command will create a well-documented example plugin. The syntax for schemas will be kept as simple as possible.
- **Risk: Sync Conflicts.** Still a risk in complex, multi-device scenarios.
  - **Mitigation:** The strict idempotency protocol and detailed, UUID-stamped commit messages remain the primary mitigation.
- **Risk: `doctor --fix` Data Loss.** An automated fix could make an unwanted change.
  - **Mitigation:** The `--fix` flag will be optional and will provide clear output on what changes it is making. Since the vault is a Git repository, any change made by `doctor` can be easily reverted.

